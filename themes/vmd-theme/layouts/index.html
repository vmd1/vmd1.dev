{{ define "main" }}
        <!-- About Me Section -->
        <section class="mb-12 card card">
            <h2 class="text-2xl font-semibold mb-4 text-gray-100">Hi!</h2>
            <div class="space-y-4 text-gray-400 leading-relaxed">
            <p>I'm Vivaan, a student who's into programming, security, and breaking things (ethically, of course ðŸ˜…). This is my portfolio page where I dump my projects, write-ups, and blog posts about what I'm learning along the way.</p>
            
            <div id="about-more" class="hidden opacity-0 transition-opacity duration-500 ease-in-out">
                <p class="mt-4">Right now, I'm working on a few open-source projects - mostly related to security tools and automation. I love digging into code, figuring out how stuff works under the hood, and then building (or breaking) things just to see what happens.</p>
                <p class="mt-4">Outside of coding, I'm into gaming, reading, and working with A/V and Lighting. I'm always looking for ways to challenge myself and pick up new skills, whether that's learning a new programming language, exploring cybersecurity challenges, or contributing to communities online.</p>
                <p class="mt-4">This page will keep growing as I add more projects, write more blog posts, and (hopefully) build some cool stuff that people (apart from me) find useful. Feel free to look around - I'm sure you'll find something interesting!</p>
            </div>

            <button id="about-read-more" class="mt-4 text-blue-400 hover:text-blue-300 font-semibold focus:outline-none transition-colors flex items-center gap-1 group">
                <span>Read More</span>
                <i class="ri-arrow-down-s-line group-hover:translate-y-1 transition-transform"></i>
            </button>
            </div>
        </section>

        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const btn = document.getElementById('about-read-more');
                const content = document.getElementById('about-more');
                const btnText = btn.querySelector('span');
                const btnIcon = btn.querySelector('i');

                if(btn && content) {
                    btn.addEventListener('click', () => {
                        if (content.classList.contains('hidden')) {
                            // Expand
                            content.classList.remove('hidden');
                            // Small delay to ensure display:block applies before opacity transition
                            setTimeout(() => {
                                content.classList.remove('opacity-0');
                            }, 20);
                            
                            btnText.textContent = 'Read Less';
                            btnIcon.className = 'ri-arrow-up-s-line group-hover:-translate-y-1 transition-transform';
                        } else {
                            // Collapse
                            content.classList.add('opacity-0');
                            setTimeout(() => {
                                content.classList.add('hidden');
                            }, 500);

                            btnText.textContent = 'Read More';
                            btnIcon.className = 'ri-arrow-down-s-line group-hover:translate-y-1 transition-transform';
                        }
                    });
                }
            });
        </script>

        <!-- Unified Timeline Section -->
        <section class="mb-12">
            <div class="card static-card">
                <h2 class="text-3xl font-bold mb-12 text-gray-100 text-center">Recent Work</h2>
                <div id="timeline-wrapper" class="relative max-w-5xl mx-auto">
                    <!-- Vertical Line (Desktop only) -->
                    <div id="timeline-line" class="hidden absolute left-1/2 transform -translate-x-1/2 w-0.5 h-full bg-gradient-to-b from-blue-500/50 via-purple-500/50 to-pink-500/50"></div>
                    
                    <div id="timeline-container" class="space-y-12 md:space-y-0">
                        <div id="timeline-loading" class="flex justify-center py-12">
                            <div class="flex flex-col items-center gap-4">
                                <div class="w-12 h-12 border-4 border-gray-700 border-t-blue-500 rounded-full animate-spin"></div>
                                <p class="text-gray-400">Syncing history...</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="flex flex-col sm:flex-row justify-center items-center gap-4 mt-12 pb-6">
                    <a href="{{ "posts" | relURL }}" class="flex items-center gap-2 px-6 py-3 rounded-xl bg-slate-800/50 hover:bg-slate-700 hover:text-blue-400 border border-slate-700 hover:border-blue-500/50 transition-all duration-300 group">
                        <i class="ri-article-line text-xl group-hover:scale-110 transition-transform"></i>
                        <span class="font-semibold">Show All Posts</span>
                    </a>
                    
                    <button id="show-all-projects" class="flex items-center gap-2 px-6 py-3 rounded-xl bg-slate-800/50 hover:bg-slate-700 hover:text-blue-400 border border-slate-700 hover:border-blue-500/50 transition-all duration-300 group">
                        <i class="ri-github-line text-xl group-hover:scale-110 transition-transform"></i>
                        <span class="font-semibold">Show All Projects</span>
                    </button>
                </div>
            </div>
        </section>

        <style>
            .text-truncate-3 {
                display: -webkit-box;
                -webkit-line-clamp: 3;
                -webkit-box-orient: vertical;
                overflow: hidden;
            }
            @media (min-width: 768px) {
                .timeline-row:not(:first-child) {
                    margin-top: -2rem;
                }
            }
        </style>

        <script>
        async function buildTimeline() {
            const container = document.getElementById('timeline-container');
            const username = 'vmd1';

            function applyTilt(card) {
                card.addEventListener('mousemove', (e) => {
                    const rect = card.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    const { width, height } = rect;
                    const rotateX = (y / height - 0.5) * -10;
                    const rotateY = (x / width - 0.5) * 10;
                    card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.02)`;
                });
                card.addEventListener('mouseleave', () => {
                    card.style.transform = 'perspective(1000px) rotateX(0) rotateY(0) scale(1)';
                });
            }

            try {
                const [ownedResponse, starredResponse, postsResponse] = await Promise.all([
                    fetch(`https://api.github.com/users/${username}/repos?sort=pushed&per_page=100`),
                    fetch(`https://api.github.com/users/${username}/starred?per_page=100`),
                    fetch('/index.xml')
                ]);

                if (!ownedResponse.ok || !starredResponse.ok || !postsResponse.ok) throw new Error('Network error');

                const ownedRepos = await ownedResponse.json();
                const starredRepos = await starredResponse.json();
                
                const postsText = await postsResponse.text();
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(postsText, "text/xml");
                const postItems = Array.from(xmlDoc.querySelectorAll("item"));
                
                const posts = postItems.map(item => {
                    const link = item.querySelector("link").textContent;
                    let section = 'Post';
                    try {
                        const urlObj = new URL(link);
                        // pathname usually starts with /, splitting gives ['', 'section', 'slug', ''] or similar
                        const parts = urlObj.pathname.split('/').filter(Boolean);
                        if (parts.length > 0) {
                            // First part is section
                            let rawSection = parts[0];
                            // Format: "white-hat" -> "White Hat"
                            section = rawSection.split('-').map(s => s.charAt(0).toUpperCase() + s.slice(1)).join(' ');
                        }
                    } catch (e) {
                         // Fallback if link parsing fails
                    }

                    return {
                        title: item.querySelector("title").textContent,
                        link: link,
                        date: new Date(item.querySelector("pubDate").textContent),
                        summary: item.querySelector("description").textContent,
                        tags: Array.from(item.querySelectorAll("category")).map(c => c.textContent),
                        section: section
                    };
                });

                const starredIds = new Set(starredRepos.map(repo => repo.id));
                const projects = ownedRepos.filter(repo => starredIds.has(repo.id));

                /* 
                   Map tech names (lowercase) to Devicon class names.
                   Add more mappings as needed.
                */
                const techMap = {
                    "python": "devicon-python-plain",
                    "javascript": "devicon-javascript-plain",
                    "typescript": "devicon-typescript-plain",
                    "html": "devicon-html5-plain",
                    "css": "devicon-css3-plain",
                    "scss": "devicon-sass-original",
                    "sass": "devicon-sass-original",
                    "docker": "devicon-docker-plain",
                    "go": "devicon-go-original-wordmark",
                    "golang": "devicon-go-original-wordmark",
                    "c++": "devicon-cplusplus-plain",
                    "cpp": "devicon-cplusplus-plain",
                    "c": "devicon-c-plain",
                    "c#": "devicon-csharp-plain",
                    "csharp": "devicon-csharp-plain",
                    "java": "devicon-java-plain",
                    "rust": "devicon-rust-plain",
                    "vue": "devicon-vuejs-plain",
                    "react": "devicon-react-original",
                    "angular": "devicon-angularjs-plain",
                    "svelte": "devicon-svelte-plain",
                    "node": "devicon-nodejs-plain",
                    "nodejs": "devicon-nodejs-plain",
                    "hugo": "devicon-hugo-plain",
                    "git": "devicon-git-plain",
                    "github": "devicon-github-original",
                    "linux": "devicon-linux-plain",
                    "bash": "devicon-bash-plain",
                    "shell": "devicon-bash-plain",
                    "powershell": "devicon-powershell-plain",
                    "windows": "devicon-windows8-original",
                    "azure": "devicon-azure-plain",
                    "aws": "devicon-amazonwebservices-original",
                    "gcp": "devicon-googlecloud-plain",
                    "markdown": "devicon-markdown-original"
                };

                // Helper to generate icon or badge HTML
                const getTechHTML = (tech, allowText) => {
                    const key = tech.toLowerCase().trim();
                    // Search in map
                    if (techMap[key]) {
                        return `<i class="${techMap[key]} text-lg" title="${tech}"></i>`;
                    }
                    // Fallback to text badge only if allowed
                    if (allowText) {
                        return `<span class="bg-slate-700/50 text-slate-300 px-1.5 py-0.5 rounded text-[10px] whitespace-nowrap">${tech}</span>`;
                    }
                    return '';
                };

                const items = [
                    ...projects.map(r => ({
                        type: 'project',
                        isProject: true,
                        title: r.full_name,
                        date: new Date(r.created_at),
                        desc: r.description || 'No description available.',
                        link: r.html_url,
                        icon: 'ri-github-line',
                        // Collect languages/topics
                        technologies: [r.language, ...(r.topics || [])].filter(Boolean),
                        stars: r.stargazers_count
                    })),
                    ...posts.map(p => ({
                        type: p.section, // Use section (folder name)
                        isProject: false,
                        title: p.title,
                        date: p.date,
                        desc: p.summary,
                        link: p.link,
                        icon: 'ri-article-line',
                        technologies: p.tags,
                        stars: null
                    }))
                ].sort((a, b) => b.date - a.date);

                container.innerHTML = '';
                document.getElementById('timeline-line').classList.add('md:block');
                
                // Show vertical line
                const line = document.getElementById('timeline-line');
                if(line) line.classList.remove('hidden');

                // Helper to truncate text to n chars
                const truncateChars = (str, n) => {
                    if (!str) return '';
                    if (str.length <= n) return str;
                    return str.slice(0, n) + '...';
                };

                items.forEach((item, index) => {
                    const isLeft = index % 2 === 0;
                    const truncatedDesc = truncateChars(item.desc, 150);

                    // Generate tech icons/badges
                    // For posts (isProject=false), we disallow text tags. Use icons only.
                    let techStackHTML = '';
                    if (item.technologies && item.technologies.length > 0) {
                        const techs = item.technologies
                            .map(t => getTechHTML(t, item.isProject))
                            .filter(t => t !== ''); // Filter out empty strings
                        
                        // Only render container if we have items
                        if (techs.length > 0) {
                            techStackHTML = `
                                <div class="flex flex-wrap gap-2 mt-2">
                                    ${techs.slice(0, 6).join('')}
                                </div>
                            `;
                        }
                    }
                    
                    // Extra meta info (stars for projects)
                    let metaInfo = '';
                    if (item.stars !== null) {
                         metaInfo = `<span class="flex items-center gap-1 mr-2 text-yellow-500"><i class="ri-star-fill"></i> ${item.stars}</span>`;
                    } else {
                        // For posts, maybe showing "Blog Post" text is redundant if we have tags/icons?
                        // Let's leave it minimal.
                    }

                    const rowEl = document.createElement('div');
                    rowEl.className = `timeline-row flex flex-col md:flex-row w-full ${isLeft ? 'md:flex-row' : 'md:flex-row-reverse'} items-center mb-12 md:mb-0`;
                    
                    rowEl.innerHTML = `
                        <!-- Content Side -->
                        <div class="w-full md:w-[45%] ${isLeft ? 'md:pr-12' : 'md:pl-12'}">
                            <a href="${item.link}" ${item.type === 'project' ? 'target="_blank"' : ''} class="block card p-6 rounded-2xl bg-slate-900 border border-transparent shadow-none transition-all duration-300 hover:bg-slate-800 hover:border-blue-500/50 group decoration-0">
                                <span class="text-sm font-semibold text-blue-400 mb-2 block uppercase tracking-wider">
                                    ${item.date.toLocaleDateString(undefined, { month: 'short', day: 'numeric' })} Â· ${item.type}
                                </span>
                                <h3 class="text-xl font-bold text-gray-100 mb-3 group-hover:text-blue-400 transition-colors">
                                    ${item.title}
                                </h3>
                                <p class="text-gray-400 text-sm text-truncate-3 leading-relaxed mb-4" title="${item.desc}">${truncatedDesc}</p>
                                
                                <div class="flex items-end justify-between">
                                    <div class="flex flex-col">
                                         ${techStackHTML}
                                    </div>
                                    <div class="flex items-center text-gray-500 text-[11px] font-mono shrink-0 ml-2">
                                        ${metaInfo}
                                        <i class="${item.icon} text-lg text-blue-500/50"></i>
                                    </div>
                                </div>
                            </a>
                        </div>

                        <!-- Center Dot & Line Connectors -->
                        <div class="hidden md:flex absolute left-1/2 transform -translate-x-1/2 items-center justify-center w-8 h-8 z-20">
                            <div class="w-4 h-4 rounded-full bg-blue-500 shadow-[0_0_15px_rgba(59,130,246,0.5)] border-4 border-slate-900"></div>
                            <div class="absolute ${isLeft ? 'right-full' : 'left-full'} h-px w-12 bg-gradient-to-r ${isLeft ? 'from-transparent to-blue-500/50' : 'from-blue-500/50 to-transparent'}"></div>
                        </div>

                        <!-- Spacing Side -->
                        <div class="hidden md:block w-full md:w-[45%]"></div>
                    `;
                    
                    container.appendChild(rowEl);
                    applyTilt(rowEl.querySelector('.card'));
                });

            } catch (err) {
                console.error(err);
                container.innerHTML = `<p class="text-center text-red-400 py-10">Sync failed: ${err.message}</p>`;
            }
        }
        buildTimeline();
        </script>
{{ end }}
