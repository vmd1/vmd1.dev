<a href="https://up.vmd1.dev" target="_blank" rel="noopener noreferrer" id="downtime-alert" class="hidden mb-8 block transition-all duration-500 ease-in-out hover:no-underline select-none">
    <div class="card border-red-500/50 bg-red-900/10 backdrop-blur-sm hover:bg-red-900/20 transition-colors duration-200">
        <div class="flex items-center gap-4">
            <div class="flex-shrink-0 w-12 h-12 flex items-center justify-center bg-red-500/20 rounded-full text-red-500">
                <i class="ri-error-warning-line text-2xl animate-pulse"></i>
            </div>
            <div class="flex-grow">
                <h2 class="text-xl font-bold text-red-500">Service Interruption</h2>
                <p class="text-gray-300">Partially degraded service on: <span id="down-services" class="font-semibold text-gray-100"></span></p>
            </div>
            <div class="hidden sm:flex items-center gap-2 text-red-400">
                <span class="text-sm font-medium">Details</span>
                <i class="ri-arrow-right-line"></i>
            </div>
        </div>
    </div>
</a>

<script>
    (function() {
        const STATUS_PAGE_SLUG = 'vmd1-dev';
        const STATUS_API = `https://up.vmd1.dev/api/status-page/${STATUS_PAGE_SLUG}`;
        const HEARTBEAT_API = `https://up.vmd1.dev/api/status-page/heartbeat/${STATUS_PAGE_SLUG}`;

        async function fetchStatus() {
            try {
                const [configRes, heartbeatRes] = await Promise.all([
                    fetch(STATUS_API),
                    fetch(HEARTBEAT_API)
                ]);

                if (!configRes.ok || !heartbeatRes.ok) return;

                const config = await configRes.json();
                const heartbeats = await heartbeatRes.json();

                const monitorNames = {};
                if (config.publicGroupList) {
                    config.publicGroupList.forEach(group => {
                        if (group.monitorList) {
                            group.monitorList.forEach(monitor => {
                                monitorNames[monitor.id] = monitor.name;
                            });
                        }
                    });
                }

                const downServices = [];
                if (heartbeats.heartbeatList) {
                    for (const monitorId in heartbeats.heartbeatList) {
                        const list = heartbeats.heartbeatList[monitorId];
                        if (list && list.length > 0) {
                            // Extract the latest heartbeat (last in array)
                            const latest = list[list.length - 1];
                            // Status 0 is Down
                            if (latest.status === 0 && monitorNames[monitorId]) {
                                downServices.push(monitorNames[monitorId]);
                            }
                        }
                    }
                }

                if (downServices.length > 0) {
                    const alertEl = document.getElementById('downtime-alert');
                    const servicesEl = document.getElementById('down-services');
                    
                    servicesEl.textContent = downServices.join(', ');
                    alertEl.classList.remove('hidden');
                    // Add a small delay for opacity transition if we want it to be smooth
                    setTimeout(() => {
                        alertEl.classList.add('opacity-100');
                    }, 10);
                }
            } catch (error) {
                console.error('Uptime Kuma fetch error:', error);
            }
        }

        // Run once on load
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', fetchStatus);
        } else {
            fetchStatus();
        }
    })();
</script>
